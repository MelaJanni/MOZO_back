rules_version = "2";
service cloud.firestore {
  match /databases/{database}/documents {
    // üîì REGLAS P√öBLICAS PARA QR CODES - Permiten acceso an√≥nimo controlado
    
    // Llamadas de mozo desde QR (lectura p√∫blica, escritura desde backend)
    match /tables/{tableId}/waiter_calls/{callId} {
      allow read: if true; // Permitir lectura p√∫blica para monitoreo tiempo real
      allow write: if request.auth != null; // Solo backend autenticado puede escribir
    }
    
    // Estado de mesas (lectura p√∫blica limitada)
    match /tables/{tableId}/status/{document} {
      allow read: if true; // Permitir lectura para QR codes
      allow write: if request.auth != null; // Solo backend puede escribir
    }
    
    // üë§ REGLAS PARA MOZOS AUTENTICADOS
    
    // Llamadas asignadas a mozos espec√≠ficos
    match /waiters/{waiterId}/calls/{callId} {
      allow read, write: if request.auth != null;
    }
    
    // Llamadas por negocio (para managers/admins)
    match /businesses/{businessId}/waiter_calls/{callId} {
      allow read, write: if request.auth != null;
    }
    
    // Estado de mesas por negocio
    match /businesses/{businessId}/table_status/{tableId} {
      allow read, write: if request.auth != null;
    }
    
    // üì± NOTIFICACIONES DE USUARIO
    match /users/{userId}/notifications/{notificationId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // üß™ TESTING Y DEBUG (solo en desarrollo)
    match /testing/{document=**} {
      allow read, write: if true; // Solo para testing
    }
    
    // üîê DEFAULT: Denegar todo lo dem√°s por seguridad
    // match /{document=**} {
    //   allow read, write: if false;
    // }
  }
}